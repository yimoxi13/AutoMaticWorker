# AutoMaticWorker 用户手册

## 目录

1. [介绍](#介绍)
2. [安装与启动](#安装与启动)
3. [流程编辑器](#流程编辑器)
   - [创建新流程](#创建新流程)
   - [编辑流程](#编辑流程)
   - [管理流程](#管理流程)
   - [导出流程](#导出流程)
4. [节点类型](#节点类型)
   - [开始节点](#开始节点)
   - [动作节点](#动作节点)
   - [条件节点](#条件节点)
   - [结束节点](#结束节点)
5. [流程连接](#流程连接)
6. [最佳实践](#最佳实践)
7. [常见问题解答](#常见问题解答)

## 介绍

AutoMaticWorker是一个通用的Web流程自动化脚本管理和运行工具。它允许用户通过直观的可视化界面构建、编辑和管理自动化工作流程，无需深入了解编程细节。

主要特点：
- 可视化流程编辑器
- 支持多种节点类型
- 导出流程为Python脚本
- 流程保存与管理

## 安装与启动

### 系统要求
- Python 3.8+
- Node.js 14+

### 安装步骤

1. 克隆或下载项目到本地：
   ```
   git clone <项目URL>
   cd AutoMaticWorker
   ```

2. 安装Python依赖：
   ```
   pip install -r requirements.txt
   ```

3. 启动Vue前端（仅在开发模式下需要）：
   ```
   cd vue_frontend
   npm install
   npm run dev
   ```

4. 启动应用：
   ```
   python main.py
   ```

启动后，应用会自动打开一个窗口，加载流程编辑器界面。也可以通过浏览器访问 http://localhost:5000/flow-editor/ 。

## 流程编辑器

流程编辑器是AutoMaticWorker的核心组件，通过它您可以创建、编辑和管理自动化流程。

### 创建新流程

1. 在流程编辑器主页（http://localhost:5000/flow-editor/）点击"创建新流程"按钮
2. 输入流程名称和描述（可选）
3. 点击"创建"按钮
4. 系统会自动创建一个包含开始和结束节点的基本流程，并打开流程编辑页面

### 编辑流程

在流程编辑页面，您可以：

1. **添加节点**：
   - 从左侧面板拖拽节点类型（动作节点、条件节点）到画布中
   - 系统自动创建了起始节点和结束节点

2. **编辑节点属性**：
   - 点击节点选中它
   - 在左侧属性面板中编辑节点的名称、代码或条件表达式
   - 点击"应用"按钮保存更改

3. **连接节点**：
   - 将鼠标悬停在节点上，会显示连接点
   - 点击并拖动连接点到目标节点
   - 松开鼠标完成连接

4. **删除节点或连接**：
   - 选中节点后点击"删除节点"按钮
   - 选中连接线后按键盘上的Delete键

5. **调整布局**：
   - 拖动节点可以调整位置
   - 使用工具栏上的缩放按钮可以调整视图

6. **保存流程**：
   - 点击左侧面板上的"保存流程"按钮
   - 系统会保存当前流程设计

### 管理流程

在流程编辑器主页，您可以：

1. **查看所有流程**：
   - 页面会显示所有保存的流程卡片
   - 每个卡片显示流程名称、描述、节点数量和创建/更新时间

2. **编辑现有流程**：
   - 点击流程卡片或卡片上的"编辑"按钮

3. **删除流程**：
   - 点击流程卡片上的"删除"按钮
   - 确认删除操作

### 导出流程

将流程导出为可执行的Python脚本：

1. 在流程编辑页面，点击"导出为脚本"按钮
2. 系统会生成对应的Python脚本并显示在弹出窗口中
3. 您可以复制脚本或下载为.py文件
4. 导出的脚本可以独立运行，不依赖于AutoMaticWorker

## 节点类型

### 开始节点

- **功能**：标记流程的起始点
- **属性**：
  - 名称：节点显示的名称
- **注意**：每个流程只能有一个开始节点

### 动作节点

- **功能**：执行Python代码
- **属性**：
  - 名称：节点显示的名称
  - 代码：要执行的Python代码
- **示例代码**：
  ```python
  # 获取当前时间
  import datetime
  current_time = datetime.datetime.now()
  print(f"当前时间: {current_time}")
  ```

### 条件节点

- **功能**：根据条件表达式进行分支判断
- **属性**：
  - 名称：节点显示的名称
  - 条件表达式：Python条件表达式，结果为True或False
- **示例条件**：
  ```python
  x > 10
  ```
  ```python
  "test" in my_string
  ```
  ```python
  current_time.hour < 12
  ```

### 结束节点

- **功能**：标记流程的结束点
- **属性**：
  - 名称：节点显示的名称
- **注意**：流程可以有多个结束节点

## 流程连接

连接用于定义节点之间的关系和流程流向。

- **普通连接**：连接两个节点，表示执行顺序
- **条件连接**：从条件节点出发的连接，可以设置标签（如"是"、"否"）

创建连接的步骤：
1. 鼠标悬停在源节点上
2. 点击并拖动出现的连接点
3. 拖动到目标节点并释放鼠标

## 最佳实践

1. **合理命名**：
   - 给流程和节点使用描述性的名称
   - 命名应该反映功能或目的

2. **流程结构**：
   - 保持流程结构清晰简洁
   - 避免过于复杂的条件嵌套

3. **代码编写**：
   - 在动作节点中编写简洁的代码
   - 添加注释说明代码功能
   - 注意变量作用域，确保上下文中需要的变量可用

4. **流程测试**：
   - 导出流程为脚本并测试运行
   - 确保每个分支和条件都能正常工作

5. **错误处理**：
   - 在关键代码中添加异常处理
   - 使用日志记录重要信息和错误

## 常见问题解答

### 问题: 如何在节点间传递数据？

**回答**: 在Python脚本中，节点之间可以通过变量传递数据。在前一个节点中定义的变量可以在后续节点中使用。

例如:
```python
# 动作节点1
data = {"value": 42}

# 动作节点2（在节点1之后）
print(f"从上一个节点获取的值: {data['value']}")
```

### 问题: 如何导入外部Python模块？

**回答**: 在动作节点中，您可以使用标准的Python import语句导入模块:

```python
import requests
import pandas as pd
import os

# 使用导入的模块
response = requests.get('https://api.example.com/data')
```

### 问题: 我可以在流程中使用循环吗？

**回答**: 是的，您可以在动作节点中使用Python循环:

```python
# 简单循环
for i in range(5):
    print(f"循环次数: {i}")
    
# 处理列表数据
items = ["apple", "banana", "orange"]
for item in items:
    print(f"处理: {item}")
```

### 问题: 如何保存流程执行结果？

**回答**: 您可以在动作节点中编写代码保存结果到文件:

```python
# 保存到文本文件
with open('results.txt', 'w') as f:
    f.write(f"处理结果: {result}")
    
# 保存到CSV
import pandas as pd
df = pd.DataFrame(results)
df.to_csv('results.csv', index=False)
```

### 问题: 如何处理网络请求超时？

**回答**: 使用try/except块处理可能的异常:

```python
import requests

try:
    response = requests.get('https://api.example.com/data', timeout=10)
    response.raise_for_status()  # 检查HTTP错误
    data = response.json()
except requests.exceptions.Timeout:
    print("请求超时")
    data = None
except requests.exceptions.RequestException as e:
    print(f"请求错误: {e}")
    data = None
``` 